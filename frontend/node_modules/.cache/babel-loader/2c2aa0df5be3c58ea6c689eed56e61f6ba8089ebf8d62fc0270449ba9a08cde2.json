{"ast":null,"code":"import React,{useState}from'react';import{useForm}from'react-hook-form';import Modal from'../Common/Modal';import{CurrencyDollarIcon,DocumentTextIcon,ExclamationTriangleIcon}from'@heroicons/react/24/outline';import toast from'react-hot-toast';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AddDeductionModal=_ref=>{let{isOpen,onClose,depositId,depositAmount,currentDeductions,onSubmit}=_ref;const[isSubmitting,setIsSubmitting]=useState(false);const{register,handleSubmit,watch,reset,formState:{errors}}=useForm();const watchedAmount=watch('amount',0);const remainingAmount=depositAmount-currentDeductions;const newRemaining=remainingAmount-(watchedAmount||0);const onFormSubmit=async data=>{try{setIsSubmitting(true);if(data.amount>remainingAmount){toast.error('Deduction amount cannot exceed remaining deposit amount');return;}const deductionData={date:new Date().toISOString().split('T')[0],// Today's date\namount:data.amount,description:data.description,category:data.category,receipt:data.receipt||undefined,notes:data.notes||undefined};await onSubmit(depositId,deductionData);toast.success('Deduction added successfully');reset();onClose();}catch(error){console.error('Error adding deduction:',error);toast.error('Failed to add deduction');}finally{setIsSubmitting(false);}};const handleClose=()=>{reset();onClose();};const formatCurrency=amount=>{return new Intl.NumberFormat('en-US',{style:'currency',currency:'USD',minimumFractionDigits:0,maximumFractionDigits:0}).format(amount);};return/*#__PURE__*/_jsx(Modal,{isOpen:isOpen,onClose:handleClose,title:\"Add Deduction\",maxWidth:\"lg\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit(onFormSubmit),className:\"space-y-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-50 rounded-lg p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-3 gap-4 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Original Deposit\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:formatCurrency(depositAmount)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Current Deductions\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-medium text-red-600\",children:[\"-\",formatCurrency(currentDeductions)]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Available Amount\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium text-green-600\",children:formatCurrency(remainingAmount)})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:[/*#__PURE__*/_jsx(CurrencyDollarIcon,{className:\"inline h-4 w-4 mr-1\"}),\"Deduction Amount *\"]}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.01\",min:\"0\",max:remainingAmount,...register('amount',{required:'Amount is required',min:{value:0.01,message:'Amount must be greater than $0'},max:{value:remainingAmount,message:`Amount cannot exceed ${formatCurrency(remainingAmount)}`},valueAsNumber:true}),className:\"block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500\",placeholder:\"0.00\"}),errors.amount&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-red-600\",children:errors.amount.message}),watchedAmount>0&&/*#__PURE__*/_jsxs(\"p\",{className:\"mt-1 text-xs text-gray-500\",children:[\"Remaining after deduction: \",formatCurrency(newRemaining)]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Category *\"}),/*#__PURE__*/_jsxs(\"select\",{...register('category',{required:'Category is required'}),className:\"block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select category...\"}),/*#__PURE__*/_jsx(\"option\",{value:\"damage\",children:\"Property Damage\"}),/*#__PURE__*/_jsx(\"option\",{value:\"cleaning\",children:\"Cleaning Costs\"}),/*#__PURE__*/_jsx(\"option\",{value:\"unpaid_rent\",children:\"Unpaid Rent\"}),/*#__PURE__*/_jsx(\"option\",{value:\"late_fees\",children:\"Late Fees\"}),/*#__PURE__*/_jsx(\"option\",{value:\"other\",children:\"Other\"})]}),errors.category&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-red-600\",children:errors.category.message})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:[/*#__PURE__*/_jsx(DocumentTextIcon,{className:\"inline h-4 w-4 mr-1\"}),\"Description *\"]}),/*#__PURE__*/_jsx(\"textarea\",{...register('description',{required:'Description is required'}),rows:3,className:\"block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500\",placeholder:\"Describe what this deduction is for...\"}),errors.description&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-red-600\",children:errors.description.message})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Receipt/Reference (Optional)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",...register('receipt'),className:\"block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500\",placeholder:\"Receipt number, invoice ID, etc.\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Additional Notes (Optional)\"}),/*#__PURE__*/_jsx(\"textarea\",{...register('notes'),rows:2,className:\"block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500\",placeholder:\"Any additional details about this deduction...\"})]}),watchedAmount>remainingAmount*0.8&&watchedAmount<=remainingAmount&&/*#__PURE__*/_jsx(\"div\",{className:\"rounded-md bg-yellow-50 p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0\",children:/*#__PURE__*/_jsx(ExclamationTriangleIcon,{className:\"h-5 w-5 text-yellow-400\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"ml-3\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-sm font-medium text-yellow-800\",children:\"Large Deduction Warning\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-2 text-sm text-yellow-700\",children:/*#__PURE__*/_jsxs(\"p\",{children:[\"This deduction will use \",Math.round(watchedAmount/depositAmount*100),\"% of the original deposit. Please ensure this amount is accurate.\"]})})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-3\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleClose,className:\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500\",children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:isSubmitting,className:\"px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50\",children:isSubmitting?'Adding...':'Add Deduction'})]})]})});};export default AddDeductionModal;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}