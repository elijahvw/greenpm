{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useForm}from'react-hook-form';import{propertyService}from'../../services/propertyService';import{tenantService}from'../../services/tenantService';import{XMarkIcon,CalendarIcon,CurrencyDollarIcon,HomeIcon}from'@heroicons/react/24/outline';import{toast}from'react-hot-toast';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const LeaseForm=_ref=>{let{isOpen,onClose,onSubmit,preSelectedPropertyId,loading=false}=_ref;const[properties,setProperties]=useState([]);const[tenants,setTenants]=useState([]);const[selectedProperty,setSelectedProperty]=useState(null);const[isSubmitting,setIsSubmitting]=useState(false);const{register,handleSubmit,reset,formState:{errors},setValue,watch}=useForm();const watchPropertyId=watch('propertyId');useEffect(()=>{if(isOpen){loadPropertiesAndTenants();resetForm();}},[isOpen]);useEffect(()=>{if(watchPropertyId){const property=properties.find(p=>p.id===watchPropertyId);setSelectedProperty(property||null);// Auto-fill rent from property\nif(property&&(property.rentAmount||property.rent_amount)){const rentAmount=property.rentAmount||property.rent_amount||0;setValue('monthlyRent',rentAmount);setValue('securityDeposit',rentAmount);// Default to 1 month rent\n}}},[watchPropertyId,properties,setValue]);const resetForm=()=>{reset();setSelectedProperty(null);// Set default values\nsetValue('leaseType','fixed');setValue('gracePeriodDays',5);setValue('renewalOption',true);setValue('petPolicy',{allowed:false,deposit:0,monthlyFee:0,restrictions:''});setValue('lateFeePenalty',0);setValue('utilitiesIncluded',[]);setValue('tenantResponsibilities',[]);setValue('landlordResponsibilities',[]);};const loadPropertiesAndTenants=async()=>{try{const[propertiesData,tenantsData]=await Promise.all([propertyService.getProperties(),tenantService.getTenants()]);// Filter vacant properties (based on lease_status) and active/prospective tenants\nconst availableProperties=propertiesData.filter(p=>(p.lease_status||'vacant')==='vacant');const availableTenants=tenantsData.filter(t=>['active','prospective'].includes(t.status||'prospective'));setProperties(availableProperties);setTenants(availableTenants);// Pre-select property if provided\nif(preSelectedPropertyId){const preSelectedProperty=availableProperties.find(p=>p.id===preSelectedPropertyId);if(preSelectedProperty){setValue('propertyId',preSelectedPropertyId);setSelectedProperty(preSelectedProperty);// Auto-fill rent amount from property if available\nif(preSelectedProperty.rentAmount||preSelectedProperty.rent_amount){const rentAmount=preSelectedProperty.rentAmount||preSelectedProperty.rent_amount||0;setValue('monthlyRent',rentAmount);setValue('securityDeposit',rentAmount);// Default to 1 month rent\n}}}}catch(error){console.error('Error loading properties and tenants:',error);toast.error('Failed to load properties and tenants');}};const handleFormSubmit=async data=>{try{setIsSubmitting(true);await onSubmit(data);onClose();resetForm();}catch(error){console.error('Error creating lease:',error);// Error handling is done in parent component\n}finally{setIsSubmitting(false);}};if(!isOpen)return null;return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 z-10 overflow-y-auto\",\"aria-labelledby\":\"modal-title\",role:\"dialog\",\"aria-modal\":\"true\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity\",\"aria-hidden\":\"true\",onClick:onClose}),/*#__PURE__*/_jsx(\"span\",{className:\"hidden sm:inline-block sm:align-middle sm:h-screen\",\"aria-hidden\":\"true\",children:\"\\u200B\"}),/*#__PURE__*/_jsx(\"div\",{className:\"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full sm:p-6\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit(handleFormSubmit),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900\",children:\"Create New Lease\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:onClose,className:\"text-gray-400 hover:text-gray-600\",children:/*#__PURE__*/_jsx(XMarkIcon,{className:\"h-6 w-6\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"text-md font-medium text-gray-900 mb-3 flex items-center\",children:[/*#__PURE__*/_jsx(HomeIcon,{className:\"h-5 w-5 mr-2\"}),\"Property & Tenant\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 gap-4 sm:grid-cols-2\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Property *\"}),/*#__PURE__*/_jsxs(\"select\",{...register('propertyId',{required:'Property is required'}),className:\"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 sm:text-sm\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select a property\"}),properties.map(property=>/*#__PURE__*/_jsxs(\"option\",{value:property.id,children:[property.name||property.title,\" - \",typeof property.address==='object'?property.address.street:property.address_line1,\", \",typeof property.address==='object'?property.address.city:property.city]},property.id))]}),errors.propertyId&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-red-600\",children:errors.propertyId.message})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Tenant *\"}),/*#__PURE__*/_jsxs(\"select\",{...register('tenantId',{required:'Tenant is required'}),className:\"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 sm:text-sm\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select a tenant\"}),tenants.map(tenant=>/*#__PURE__*/_jsxs(\"option\",{value:tenant.id,children:[`${tenant.firstName||''} ${tenant.lastName||''}`.trim(),\" - \",tenant.email]},tenant.id))]}),errors.tenantId&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-red-600\",children:errors.tenantId.message})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"text-md font-medium text-gray-900 mb-3 flex items-center\",children:[/*#__PURE__*/_jsx(CalendarIcon,{className:\"h-5 w-5 mr-2\"}),\"Lease Details\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 gap-4 sm:grid-cols-3\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Start Date *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",...register('startDate',{required:'Start date is required'}),className:\"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 sm:text-sm\"}),errors.startDate&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-red-600\",children:errors.startDate.message})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"End Date *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",...register('endDate',{required:'End date is required'}),className:\"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 sm:text-sm\"}),errors.endDate&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-red-600\",children:errors.endDate.message})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Lease Type *\"}),/*#__PURE__*/_jsxs(\"select\",{...register('leaseType',{required:'Lease type is required'}),className:\"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 sm:text-sm\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"fixed\",children:\"Fixed Term\"}),/*#__PURE__*/_jsx(\"option\",{value:\"month-to-month\",children:\"Month-to-Month\"}),/*#__PURE__*/_jsx(\"option\",{value:\"periodic\",children:\"Periodic\"})]}),errors.leaseType&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-red-600\",children:errors.leaseType.message})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"text-md font-medium text-gray-900 mb-3 flex items-center\",children:[/*#__PURE__*/_jsx(CurrencyDollarIcon,{className:\"h-5 w-5 mr-2\"}),\"Financial Terms\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 gap-4 sm:grid-cols-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Monthly Rent *\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-1 relative rounded-md shadow-sm\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\",children:/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500 sm:text-sm\",children:\"$\"})}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.01\",...register('monthlyRent',{required:'Monthly rent is required',min:{value:0,message:'Rent must be positive'}}),className:\"mt-1 block w-full pl-7 border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 sm:text-sm\",placeholder:\"0.00\"})]}),errors.monthlyRent&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-red-600\",children:errors.monthlyRent.message})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Security Deposit *\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-1 relative rounded-md shadow-sm\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\",children:/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500 sm:text-sm\",children:\"$\"})}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.01\",...register('securityDeposit',{required:'Security deposit is required',min:{value:0,message:'Security deposit must be positive'}}),className:\"mt-1 block w-full pl-7 border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 sm:text-sm\",placeholder:\"0.00\"})]}),errors.securityDeposit&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-red-600\",children:errors.securityDeposit.message})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Late Fee Penalty\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-1 relative rounded-md shadow-sm\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\",children:/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500 sm:text-sm\",children:\"$\"})}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.01\",...register('lateFeePenalty',{required:'Late fee penalty is required',min:{value:0,message:'Late fee penalty must be non-negative'}}),className:\"mt-1 block w-full pl-7 border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 sm:text-sm\",placeholder:\"0.00\"})]}),errors.lateFeePenalty&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-red-600\",children:errors.lateFeePenalty.message})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Grace Period (Days)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",...register('gracePeriodDays',{min:{value:0,message:'Grace period must be non-negative'}}),className:\"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 sm:text-sm\",placeholder:\"5\"}),errors.gracePeriodDays&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-red-600\",children:errors.gracePeriodDays.message})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-md font-medium text-gray-900 mb-3\",children:\"Additional Terms\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 gap-4 sm:grid-cols-2\",children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",...register('renewalOption'),className:\"rounded border-gray-300 text-green-600 shadow-sm focus:border-green-300 focus:ring focus:ring-green-200 focus:ring-opacity-50\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-2 text-sm text-gray-700\",children:\"Renewal Option Available\"})]})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",...register('petPolicy'),className:\"rounded border-gray-300 text-green-600 shadow-sm focus:border-green-300 focus:ring focus:ring-green-200 focus:ring-opacity-50\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-2 text-sm text-gray-700\",children:\"Pets Allowed\"})]})})]})]}),selectedProperty&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-green-50 border border-green-200 rounded-lg p-4\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"text-sm font-medium text-green-800 mb-2\",children:\"Selected Property\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-green-700\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:selectedProperty.name||selectedProperty.title}),/*#__PURE__*/_jsxs(\"p\",{children:[typeof selectedProperty.address==='object'?selectedProperty.address.street:selectedProperty.address_line1,\", \",typeof selectedProperty.address==='object'?selectedProperty.address.city:selectedProperty.city]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Type: \",selectedProperty.type,\" \\u2022 Rent: $\",(selectedProperty.rentAmount||selectedProperty.rent_amount||0).toLocaleString(),\"/month\"]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-8 flex justify-end space-x-3\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:onClose,className:\"bg-white py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500\",children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:isSubmitting||loading,className:\"inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed\",children:isSubmitting||loading?'Creating...':'Create Lease'})]})]})})]})});};export default LeaseForm;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}