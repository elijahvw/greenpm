{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import{propertyService}from'../services/propertyService';import{propertyLeaseService}from'../services/propertyLeaseService';import PropertyCard from'../components/Properties/PropertyCard';import PropertyForm from'../components/Properties/PropertyForm';import PropertyViewModal from'../components/Properties/PropertyViewModal';import PropertyEditModal from'../components/Properties/PropertyEditModal';import{PlusIcon,MagnifyingGlassIcon}from'@heroicons/react/24/outline';import toast from'react-hot-toast';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Properties=()=>{const navigate=useNavigate();const[properties,setProperties]=useState([]);const[loading,setLoading]=useState(true);const[formLoading,setFormLoading]=useState(false);const[isFormOpen,setIsFormOpen]=useState(false);const[editingProperty,setEditingProperty]=useState();const[isEditModalOpen,setIsEditModalOpen]=useState(false);const[viewingProperty,setViewingProperty]=useState();const[isViewModalOpen,setIsViewModalOpen]=useState(false);const[searchTerm,setSearchTerm]=useState('');const[statusFilter,setStatusFilter]=useState('all');const[typeFilter,setTypeFilter]=useState('all');const[leaseStatusFilter,setLeaseStatusFilter]=useState('all');useEffect(()=>{fetchProperties();},[]);const fetchProperties=async()=>{try{setLoading(true);console.log('🔄 Properties - Fetching properties with lease info from API...');const data=await propertyLeaseService.getPropertiesWithLeaseInfo();console.log('✅ Properties - Received data with lease info from API:',data);setProperties(data);console.log('✅ Properties - State updated with new data');}catch(error){console.error('❌ Properties - Error fetching properties with lease info:',error);toast.error('Failed to load properties');}finally{setLoading(false);}};const handleUpdateProperty=async data=>{try{setFormLoading(true);console.log('🔄 Updating property:',data);const updatedProperty=await propertyService.updateProperty(data);console.log('✅ Property updated:',updatedProperty);// Refresh properties to get updated lease information\nawait fetchProperties();setIsFormOpen(false);setEditingProperty(undefined);toast.success('Property updated successfully');}catch(error){console.error('❌ Error updating property:',error);toast.error('Failed to update property');}finally{setFormLoading(false);}};const handleDeleteProperty=async propertyId=>{if(!window.confirm('Are you sure you want to delete this property? This action cannot be undone.')){return;}try{await propertyService.deleteProperty(propertyId);setProperties(properties.filter(p=>p.id!==propertyId));toast.success('Property deleted successfully');}catch(error){console.error('Error deleting property:',error);toast.error('Failed to delete property');}};const handleEditProperty=property=>{console.log('Edit button clicked for property:',property);console.log('Property name fields:',{name:property.name,title:property.title,id:property.id});setEditingProperty(property);setIsFormOpen(true);// Use the form modal, not edit modal\n};const handleViewProperty=property=>{setViewingProperty(property);setIsViewModalOpen(true);};const handleEditSubmit=async data=>{try{if(!(editingProperty!==null&&editingProperty!==void 0&&editingProperty.id))return;console.log('🔄 Properties - About to update property with data:',data);const result=await propertyService.updateProperty(data);console.log('✅ Properties - Update successful, result:',result);toast.success('Property updated successfully!');console.log('🔄 Properties - Fetching updated properties...');await fetchProperties();console.log('✅ Properties - Properties refreshed');setIsEditModalOpen(false);setEditingProperty(undefined);}catch(error){console.error('❌ Properties - Error updating property:',error);toast.error('Failed to update property');throw error;}};const openCreateForm=()=>{navigate('/dashboard/properties/create');};const closeForm=()=>{setIsFormOpen(false);setEditingProperty(undefined);};// Filter properties based on search and filters\nconst filteredProperties=properties.filter(property=>{// Handle different address formats from API\nlet addressString='';if(typeof property.address==='string'){addressString=property.address;}else if(property.address&&typeof property.address==='object'){addressString=`${property.address.street||''} ${property.address.city||''}`;}else{// Use individual fields from API\nconst street=property.street||property.address_line1||'';const city=property.city||'';addressString=`${street} ${city}`;}const propertyName=property.name||property.title||'';const matchesSearch=propertyName.toLowerCase().includes(searchTerm.toLowerCase())||addressString.toLowerCase().includes(searchTerm.toLowerCase());const matchesStatus=statusFilter==='all'||(property.status||'available')===statusFilter;const matchesType=typeFilter==='all'||property.type===typeFilter;const matchesLeaseStatus=leaseStatusFilter==='all'||(property.lease_status||'vacant')===leaseStatusFilter;return matchesSearch&&matchesStatus&&matchesType&&matchesLeaseStatus;});const getStatusCounts=()=>{return{all:properties.length,available:properties.filter(p=>p.status==='available').length,occupied:properties.filter(p=>p.status==='occupied').length,maintenance:properties.filter(p=>p.status==='maintenance').length,inactive:properties.filter(p=>p.status==='inactive').length};};const getLeaseStatusCounts=()=>{return{all:properties.length,vacant:properties.filter(p=>(p.lease_status||'vacant')==='vacant').length,occupied:properties.filter(p=>(p.lease_status||'vacant')==='occupied').length,pending:properties.filter(p=>(p.lease_status||'vacant')==='pending').length};};const statusCounts=getStatusCounts();const leaseStatusCounts=getLeaseStatusCounts();if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center h-64\",children:/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600\"})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"md:flex md:items-center md:justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"min-w-0 flex-1\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold leading-7 text-gray-900 sm:truncate sm:text-3xl sm:tracking-tight\",children:\"Properties\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-gray-500\",children:\"Manage your rental properties and their details\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-4 flex md:ml-4 md:mt-0\",children:/*#__PURE__*/_jsxs(\"button\",{type:\"button\",onClick:openCreateForm,className:\"inline-flex items-center rounded-md bg-green-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-green-600\",children:[/*#__PURE__*/_jsx(PlusIcon,{className:\"h-4 w-4 mr-2\"}),\"Add Property\"]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-5\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-white overflow-hidden shadow rounded-lg\",children:/*#__PURE__*/_jsx(\"div\",{className:\"p-5\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0\",children:/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"span\",{className:\"text-blue-600 font-semibold text-sm\",children:\"ALL\"})})}),/*#__PURE__*/_jsx(\"div\",{className:\"ml-5 w-0 flex-1\",children:/*#__PURE__*/_jsxs(\"dl\",{children:[/*#__PURE__*/_jsx(\"dt\",{className:\"text-sm font-medium text-gray-500 truncate\",children:\"Total Properties\"}),/*#__PURE__*/_jsx(\"dd\",{className:\"text-lg font-medium text-gray-900\",children:statusCounts.all})]})})]})})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white overflow-hidden shadow rounded-lg\",children:/*#__PURE__*/_jsx(\"div\",{className:\"p-5\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0\",children:/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"span\",{className:\"text-green-600 font-semibold text-sm\",children:\"AV\"})})}),/*#__PURE__*/_jsx(\"div\",{className:\"ml-5 w-0 flex-1\",children:/*#__PURE__*/_jsxs(\"dl\",{children:[/*#__PURE__*/_jsx(\"dt\",{className:\"text-sm font-medium text-gray-500 truncate\",children:\"Available\"}),/*#__PURE__*/_jsx(\"dd\",{className:\"text-lg font-medium text-gray-900\",children:statusCounts.available})]})})]})})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white overflow-hidden shadow rounded-lg\",children:/*#__PURE__*/_jsx(\"div\",{className:\"p-5\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0\",children:/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"span\",{className:\"text-blue-600 font-semibold text-sm\",children:\"OC\"})})}),/*#__PURE__*/_jsx(\"div\",{className:\"ml-5 w-0 flex-1\",children:/*#__PURE__*/_jsxs(\"dl\",{children:[/*#__PURE__*/_jsx(\"dt\",{className:\"text-sm font-medium text-gray-500 truncate\",children:\"Occupied\"}),/*#__PURE__*/_jsx(\"dd\",{className:\"text-lg font-medium text-gray-900\",children:statusCounts.occupied})]})})]})})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white overflow-hidden shadow rounded-lg\",children:/*#__PURE__*/_jsx(\"div\",{className:\"p-5\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0\",children:/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"span\",{className:\"text-yellow-600 font-semibold text-sm\",children:\"MT\"})})}),/*#__PURE__*/_jsx(\"div\",{className:\"ml-5 w-0 flex-1\",children:/*#__PURE__*/_jsxs(\"dl\",{children:[/*#__PURE__*/_jsx(\"dt\",{className:\"text-sm font-medium text-gray-500 truncate\",children:\"Maintenance\"}),/*#__PURE__*/_jsx(\"dd\",{className:\"text-lg font-medium text-gray-900\",children:statusCounts.maintenance})]})})]})})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white overflow-hidden shadow rounded-lg\",children:/*#__PURE__*/_jsx(\"div\",{className:\"p-5\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0\",children:/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600 font-semibold text-sm\",children:\"IN\"})})}),/*#__PURE__*/_jsx(\"div\",{className:\"ml-5 w-0 flex-1\",children:/*#__PURE__*/_jsxs(\"dl\",{children:[/*#__PURE__*/_jsx(\"dt\",{className:\"text-sm font-medium text-gray-500 truncate\",children:\"Inactive\"}),/*#__PURE__*/_jsx(\"dd\",{className:\"text-lg font-medium text-gray-900\",children:statusCounts.inactive})]})})]})})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white shadow rounded-lg p-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\",children:/*#__PURE__*/_jsx(MagnifyingGlassIcon,{className:\"h-5 w-5 text-gray-400\"})}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search properties...\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value),className:\"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-green-500 focus:border-green-500 sm:text-sm\"})]}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"select\",{value:leaseStatusFilter,onChange:e=>setLeaseStatusFilter(e.target.value),className:\"block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm rounded-md\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"All Lease Status\"}),/*#__PURE__*/_jsx(\"option\",{value:\"vacant\",children:\"Vacant\"}),/*#__PURE__*/_jsx(\"option\",{value:\"occupied\",children:\"Occupied\"}),/*#__PURE__*/_jsx(\"option\",{value:\"pending\",children:\"Pending\"})]})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"select\",{value:statusFilter,onChange:e=>setStatusFilter(e.target.value),className:\"block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm rounded-md\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"All Statuses\"}),/*#__PURE__*/_jsx(\"option\",{value:\"available\",children:\"Available\"}),/*#__PURE__*/_jsx(\"option\",{value:\"occupied\",children:\"Occupied\"}),/*#__PURE__*/_jsx(\"option\",{value:\"maintenance\",children:\"Maintenance\"}),/*#__PURE__*/_jsx(\"option\",{value:\"inactive\",children:\"Inactive\"})]})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"select\",{value:typeFilter,onChange:e=>setTypeFilter(e.target.value),className:\"block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm rounded-md\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"All Types\"}),/*#__PURE__*/_jsx(\"option\",{value:\"apartment\",children:\"Apartment\"}),/*#__PURE__*/_jsx(\"option\",{value:\"house\",children:\"House\"}),/*#__PURE__*/_jsx(\"option\",{value:\"condo\",children:\"Condo\"}),/*#__PURE__*/_jsx(\"option\",{value:\"townhouse\",children:\"Townhouse\"}),/*#__PURE__*/_jsx(\"option\",{value:\"commercial\",children:\"Commercial\"})]})})]})}),filteredProperties.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-12\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mx-auto h-12 w-12 text-gray-400\",children:/*#__PURE__*/_jsx(\"svg\",{fill:\"none\",viewBox:\"0 0 24 24\",stroke:\"currentColor\",\"aria-hidden\":\"true\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\"})})}),/*#__PURE__*/_jsx(\"h3\",{className:\"mt-2 text-sm font-medium text-gray-900\",children:\"No properties found\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-gray-500\",children:properties.length===0?\"Get started by creating your first property.\":\"Try adjusting your search or filter criteria.\"}),properties.length===0&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-6\",children:/*#__PURE__*/_jsxs(\"button\",{type:\"button\",onClick:openCreateForm,className:\"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500\",children:[/*#__PURE__*/_jsx(PlusIcon,{className:\"h-4 w-4 mr-2\"}),\"Add Property\"]})})]}):/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3\",children:filteredProperties.map(property=>/*#__PURE__*/_jsx(PropertyCard,{property:property,onEdit:handleEditProperty,onDelete:handleDeleteProperty,onView:handleViewProperty},property.id))}),editingProperty&&/*#__PURE__*/_jsx(PropertyForm,{property:editingProperty,isOpen:isFormOpen,onClose:closeForm,onSubmit:async data=>{await handleUpdateProperty(data);},loading:formLoading}),viewingProperty&&/*#__PURE__*/_jsx(PropertyViewModal,{isOpen:isViewModalOpen,onClose:()=>{setIsViewModalOpen(false);setViewingProperty(undefined);},property:viewingProperty,onEdit:handleEditProperty,onViewLeases:propertyId=>{console.log('Navigate to leases for property:',propertyId);navigate(`/dashboard/leases?propertyId=${propertyId}`);toast.success('Viewing leases for this property');}}),editingProperty&&/*#__PURE__*/_jsx(PropertyEditModal,{isOpen:isEditModalOpen,onClose:()=>{setIsEditModalOpen(false);setEditingProperty(undefined);},property:editingProperty,onSubmit:handleEditSubmit})]});};export default Properties;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}