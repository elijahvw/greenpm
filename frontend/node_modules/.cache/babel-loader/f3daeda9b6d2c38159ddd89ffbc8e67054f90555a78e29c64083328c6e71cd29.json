{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Dialog}from'@headlessui/react';import{useForm}from'react-hook-form';import{XMarkIcon,PencilIcon}from'@heroicons/react/24/outline';import{roundToCents}from'../../utils/currency';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const LeaseEditModal=_ref=>{let{isOpen,onClose,lease,onSubmit}=_ref;const[loading,setLoading]=useState(false);const{register,handleSubmit,reset,formState:{errors}}=useForm();useEffect(()=>{if(isOpen&&lease){var _lease$status;// Pre-populate form with current lease data\nreset({monthlyRent:lease.rent_amount||lease.monthlyRent||0,securityDeposit:lease.security_deposit||lease.securityDeposit||0,lateFeePenalty:lease.late_fee_penalty||lease.lateFeePenalty||0,gracePeriodDays:lease.grace_period_days||lease.gracePeriodDays||5,startDate:(lease.start_date||lease.startDate||'').split('T')[0],endDate:(lease.end_date||lease.endDate||'').split('T')[0],leaseType:lease.lease_type||lease.leaseType||'fixed',status:((_lease$status=lease.status)===null||_lease$status===void 0?void 0:_lease$status.toLowerCase())||'active',notes:lease.notes||'',specialTerms:lease.special_terms||lease.specialTerms||''});}},[isOpen,lease,reset]);const handleFormSubmit=async data=>{try{setLoading(true);console.log('ðŸ“ LeaseEditModal - Form data:',data);console.log('ðŸ“ LeaseEditModal - Original lease:',lease);const updateData={id:lease.id,monthlyRent:roundToCents(data.monthlyRent||0),securityDeposit:roundToCents(data.securityDeposit||0),lateFeePenalty:roundToCents(data.lateFeePenalty||0),gracePeriodDays:data.gracePeriodDays,startDate:data.startDate,endDate:data.endDate,leaseType:data.leaseType,status:data.status,notes:data.notes,specialTerms:data.specialTerms};console.log('ðŸ“ LeaseEditModal - Update data being sent:',updateData);await onSubmit(updateData);onClose();}catch(error){console.error('âŒ Error updating lease:',error);// Don't close modal on error - let user try again\n}finally{setLoading(false);}};if(!isOpen)return null;return/*#__PURE__*/_jsxs(Dialog,{open:isOpen,onClose:onClose,className:\"relative z-50\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-25\"}),/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 overflow-y-auto\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex min-h-full items-center justify-center p-4 text-center\",children:/*#__PURE__*/_jsxs(Dialog.Panel,{className:\"w-full max-w-4xl transform overflow-hidden rounded-lg bg-white p-6 text-left align-middle shadow-xl transition-all\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(PencilIcon,{className:\"h-6 w-6 text-blue-600 mr-3\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Dialog.Title,{className:\"text-lg font-medium text-gray-900\",children:\"Edit Lease\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-500\",children:[\"Modify lease details for \",lease.tenant_name||'tenant']})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500\",children:/*#__PURE__*/_jsx(XMarkIcon,{className:\"h-6 w-6\"})})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit(handleFormSubmit),className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-50 rounded-lg p-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-sm font-medium text-gray-900 mb-2\",children:\"Lease Information\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium text-gray-500\",children:\"Property:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-2 text-gray-900\",children:lease.property_name||'N/A'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium text-gray-500\",children:\"Tenant:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-2 text-gray-900\",children:lease.tenant_name||'N/A'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium text-gray-500\",children:\"Email:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-2 text-gray-900\",children:lease.tenant_email||'N/A'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium text-gray-500\",children:\"Phone:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-2 text-gray-900\",children:lease.tenant_phone||'N/A'})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Monthly Rent *\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"absolute left-3 top-2 text-gray-500\",children:\"$\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"1\",min:\"0\",...register('monthlyRent',{required:'Monthly rent is required',min:{value:0,message:'Rent must be positive'},valueAsNumber:true,setValueAs:value=>{// Round to nearest cent to avoid floating point issues\nconst num=parseFloat(value);return isNaN(num)?0:Math.round(num*100)/100;}}),className:\"pl-8 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500\"})]}),errors.monthlyRent&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-xs text-red-600\",children:errors.monthlyRent.message})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Security Deposit\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"absolute left-3 top-2 text-gray-500\",children:\"$\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"1\",min:\"0\",...register('securityDeposit',{min:{value:0,message:'Deposit must be positive'},valueAsNumber:true,setValueAs:value=>{const num=parseFloat(value);return isNaN(num)?0:Math.round(num*100)/100;}}),className:\"pl-8 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500\"})]}),errors.securityDeposit&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-xs text-red-600\",children:errors.securityDeposit.message})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Late Fee Penalty\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"absolute left-3 top-2 text-gray-500\",children:\"$\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"1\",min:\"0\",...register('lateFeePenalty',{min:{value:0,message:'Late fee must be positive'},valueAsNumber:true,setValueAs:value=>{const num=parseFloat(value);return isNaN(num)?0:Math.round(num*100)/100;}}),className:\"pl-8 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500\"})]}),errors.lateFeePenalty&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-xs text-red-600\",children:errors.lateFeePenalty.message})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Start Date *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",...register('startDate',{required:'Start date is required'}),className:\"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500\"}),errors.startDate&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-xs text-red-600\",children:errors.startDate.message})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"End Date *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",...register('endDate',{required:'End date is required'}),className:\"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500\"}),errors.endDate&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-xs text-red-600\",children:errors.endDate.message})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Lease Type\"}),/*#__PURE__*/_jsxs(\"select\",{...register('leaseType'),className:\"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"fixed\",children:\"Fixed Term\"}),/*#__PURE__*/_jsx(\"option\",{value:\"month-to-month\",children:\"Month-to-Month\"}),/*#__PURE__*/_jsx(\"option\",{value:\"yearly\",children:\"Yearly\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Status\"}),/*#__PURE__*/_jsxs(\"select\",{...register('status'),className:\"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"draft\",children:\"Draft\"}),/*#__PURE__*/_jsx(\"option\",{value:\"pending\",children:\"Pending\"}),/*#__PURE__*/_jsx(\"option\",{value:\"active\",children:\"Active\"}),/*#__PURE__*/_jsx(\"option\",{value:\"expired\",children:\"Expired\"}),/*#__PURE__*/_jsx(\"option\",{value:\"terminated\",children:\"Terminated\"})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4\",children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Grace Period (Days)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",...register('gracePeriodDays',{min:{value:0,message:'Grace period must be positive'}}),className:\"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500\"}),errors.gracePeriodDays&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-xs text-red-600\",children:errors.gracePeriodDays.message})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Special Terms\"}),/*#__PURE__*/_jsx(\"textarea\",{...register('specialTerms'),rows:3,className:\"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500\",placeholder:\"Any special terms or conditions...\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Notes\"}),/*#__PURE__*/_jsx(\"textarea\",{...register('notes'),rows:3,className:\"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500\",placeholder:\"Internal notes about this lease...\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-3 pt-6 border-t border-gray-200\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:onClose,disabled:loading,className:\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50\",children:\"Cancel\"}),/*#__PURE__*/_jsxs(\"button\",{type:\"submit\",disabled:loading,className:\"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed flex items-center\",children:[loading&&/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"}),loading?'Saving...':'Save Changes']})]})]})]})})})]});};export default LeaseEditModal;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}