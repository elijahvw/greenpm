{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Link}from'react-router-dom';import{useAuth}from'../contexts/AuthContext';import{MaintenanceService}from'../services/api';import{PlusIcon,MagnifyingGlassIcon,WrenchScrewdriverIcon,ExclamationTriangleIcon,CheckCircleIcon,ClockIcon,CogIcon}from'@heroicons/react/24/outline';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Maintenance=()=>{const{user}=useAuth();const[requests,setRequests]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[searchTerm,setSearchTerm]=useState('');const[filters,setFilters]=useState({status:'',priority:'',category:'',emergency_only:false});useEffect(()=>{fetchMaintenanceRequests();},[filters]);const fetchMaintenanceRequests=async()=>{try{setLoading(true);const params={...filters,skip:0,limit:50};const data=await MaintenanceService.getMaintenanceRequests(params);setRequests(data.requests);}catch(err){setError(err.message||'Failed to fetch maintenance requests');}finally{setLoading(false);}};const handleCloseRequest=async id=>{const resolution=prompt('Please provide resolution notes:');if(!resolution)return;try{await MaintenanceService.closeMaintenanceRequest(id,resolution);fetchMaintenanceRequests();}catch(err){setError(err.message||'Failed to close maintenance request');}};const filteredRequests=requests.filter(request=>request.title.toLowerCase().includes(searchTerm.toLowerCase())||request.description.toLowerCase().includes(searchTerm.toLowerCase()));if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center h-64\",children:/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-32 w-32 border-b-2 border-green-500\"})});}if(error){return/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-50 border border-red-200 rounded-md p-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"ml-3\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-sm font-medium text-red-800\",children:\"Error\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-red-700 mt-1\",children:error})]})})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900\",children:\"Maintenance\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-gray-600\",children:(user===null||user===void 0?void 0:user.role)==='tenant'?'Your maintenance requests':'Manage maintenance requests'})]}),(user===null||user===void 0?void 0:user.role)==='tenant'&&/*#__PURE__*/_jsxs(Link,{to:\"/maintenance/new\",className:\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700\",children:[/*#__PURE__*/_jsx(PlusIcon,{className:\"h-4 w-4 mr-2\"}),\"Submit Request\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white shadow rounded-lg\",children:/*#__PURE__*/_jsx(\"div\",{className:\"px-4 py-5 sm:p-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-col sm:flex-row gap-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"sr-only\",children:\"Search requests\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\",children:/*#__PURE__*/_jsx(MagnifyingGlassIcon,{className:\"h-5 w-5 text-gray-400\"})}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value),className:\"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-green-500 focus:border-green-500\",placeholder:\"Search maintenance requests...\"})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Status\"}),/*#__PURE__*/_jsxs(\"select\",{value:filters.status,onChange:e=>setFilters(prev=>({...prev,status:e.target.value})),className:\"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm rounded-md\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"All Statuses\"}),/*#__PURE__*/_jsx(\"option\",{value:\"open\",children:\"Open\"}),/*#__PURE__*/_jsx(\"option\",{value:\"in_progress\",children:\"In Progress\"}),/*#__PURE__*/_jsx(\"option\",{value:\"completed\",children:\"Completed\"}),/*#__PURE__*/_jsx(\"option\",{value:\"closed\",children:\"Closed\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Priority\"}),/*#__PURE__*/_jsxs(\"select\",{value:filters.priority,onChange:e=>setFilters(prev=>({...prev,priority:e.target.value})),className:\"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm rounded-md\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"All Priorities\"}),/*#__PURE__*/_jsx(\"option\",{value:\"low\",children:\"Low\"}),/*#__PURE__*/_jsx(\"option\",{value:\"medium\",children:\"Medium\"}),/*#__PURE__*/_jsx(\"option\",{value:\"high\",children:\"High\"}),/*#__PURE__*/_jsx(\"option\",{value:\"urgent\",children:\"Urgent\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Category\"}),/*#__PURE__*/_jsxs(\"select\",{value:filters.category,onChange:e=>setFilters(prev=>({...prev,category:e.target.value})),className:\"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm rounded-md\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"All Categories\"}),/*#__PURE__*/_jsx(\"option\",{value:\"plumbing\",children:\"Plumbing\"}),/*#__PURE__*/_jsx(\"option\",{value:\"electrical\",children:\"Electrical\"}),/*#__PURE__*/_jsx(\"option\",{value:\"hvac\",children:\"HVAC\"}),/*#__PURE__*/_jsx(\"option\",{value:\"appliances\",children:\"Appliances\"}),/*#__PURE__*/_jsx(\"option\",{value:\"flooring\",children:\"Flooring\"}),/*#__PURE__*/_jsx(\"option\",{value:\"painting\",children:\"Painting\"}),/*#__PURE__*/_jsx(\"option\",{value:\"other\",children:\"Other\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",id:\"emergency-only\",checked:filters.emergency_only,onChange:e=>setFilters(prev=>({...prev,emergency_only:e.target.checked})),className:\"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded\"}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"emergency-only\",className:\"ml-2 block text-sm text-gray-900\",children:\"Emergency Only\"})]})]})]})})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white shadow overflow-hidden sm:rounded-md\",children:/*#__PURE__*/_jsx(\"ul\",{className:\"divide-y divide-gray-200\",children:filteredRequests.map(request=>/*#__PURE__*/_jsx(MaintenanceRequestItem,{request:request,userRole:user===null||user===void 0?void 0:user.role,onClose:handleCloseRequest},request.id))})}),filteredRequests.length===0&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-12\",children:[/*#__PURE__*/_jsx(WrenchScrewdriverIcon,{className:\"mx-auto h-12 w-12 text-gray-400\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"mt-2 text-sm font-medium text-gray-900\",children:\"No maintenance requests found\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-gray-500\",children:searchTerm?'Try adjusting your search criteria.':(user===null||user===void 0?void 0:user.role)==='tenant'?'Submit a request when you need maintenance.':'Maintenance requests will appear here when tenants submit them.'}),(user===null||user===void 0?void 0:user.role)==='tenant'&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-6\",children:/*#__PURE__*/_jsxs(Link,{to:\"/maintenance/new\",className:\"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700\",children:[/*#__PURE__*/_jsx(PlusIcon,{className:\"h-4 w-4 mr-2\"}),\"Submit Request\"]})})]})]});};const MaintenanceRequestItem=_ref=>{var _request$property;let{request,userRole,onClose}=_ref;const statusIcons={open:ClockIcon,in_progress:CogIcon,completed:CheckCircleIcon,closed:CheckCircleIcon};const statusColors={open:'text-yellow-600 bg-yellow-100',in_progress:'text-blue-600 bg-blue-100',completed:'text-green-600 bg-green-100',closed:'text-gray-600 bg-gray-100'};const priorityColors={low:'text-green-600 bg-green-100',medium:'text-yellow-600 bg-yellow-100',high:'text-orange-600 bg-orange-100',urgent:'text-red-600 bg-red-100'};const StatusIcon=statusIcons[request.status];return/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"px-4 py-4 sm:px-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0\",children:request.is_emergency?/*#__PURE__*/_jsx(ExclamationTriangleIcon,{className:\"h-6 w-6 text-red-500\"}):/*#__PURE__*/_jsx(StatusIcon,{className:\"h-6 w-6 text-gray-400\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"ml-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-900 truncate\",children:request.title}),request.is_emergency&&/*#__PURE__*/_jsx(\"span\",{className:\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800\",children:\"Emergency\"}),/*#__PURE__*/_jsx(\"span\",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusColors[request.status]}`,children:request.status}),/*#__PURE__*/_jsx(\"span\",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${priorityColors[request.priority]}`,children:request.priority})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-2 flex items-center text-sm text-gray-500\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"truncate\",children:[request.category,\" \\u2022 \",((_request$property=request.property)===null||_request$property===void 0?void 0:_request$property.name)||'Property']})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Link,{to:`/maintenance/${request.id}`,className:\"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50\",children:\"View Details\"}),userRole==='landlord'&&request.status==='completed'&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>onClose(request.id),className:\"inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700\",children:[/*#__PURE__*/_jsx(CheckCircleIcon,{className:\"h-4 w-4 mr-1\"}),\"Close\"]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-2\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600 line-clamp-2\",children:request.description})}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 sm:flex sm:justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"sm:flex\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"flex items-center text-sm text-gray-500\",children:[\"Created: \",new Date(request.created_at).toLocaleDateString()]}),request.location&&/*#__PURE__*/_jsxs(\"p\",{className:\"mt-2 flex items-center text-sm text-gray-500 sm:mt-0 sm:ml-6\",children:[\"Location: \",request.location]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-2 flex items-center text-sm text-gray-500 sm:mt-0\",children:request.estimated_cost&&/*#__PURE__*/_jsxs(\"p\",{children:[\"Estimated Cost: $\",request.estimated_cost]})})]})]})});};export default Maintenance;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}